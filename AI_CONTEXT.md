# Student Voice Platform - AI Context & Documentation

> **Autogenerated by Gemini**
> **Date:** February 21, 2026

This document is intended for future AI instances to quickly understand the structure, architecture, and logic of the `student-voice-platform` project.

## 1. Project Overview

**Stack:**
- Framework: Next.js 16.1.6 (App Router)
- UI Library: React 19.2.3
- Styling: Tailwind CSS v4, `shadcn/ui`, `lucide-react`, `framer-motion`
- Database & Auth: Supabase (`@supabase/supabase-js`)
- AI Provider: Google Generative AI (`@google/generative-ai` model: gemini-2.5-flash)
- Data Vis: `recharts`, `react-force-graph-2d`
- Utility: `zod` (validation), `date-fns` (dates), `papaparse` (CSV).

**Purpose:**
An AI-powered analytics dashboard for LP2MU UPH. It allows administrators to import student feedback surveys (CSV), use AI to parse the text feedback into actionable sub-segments (classifying them by sentiment, target unit, and category), and visualize the aggregated results across units.

## 2. Directory Architecture

### Root Directory
- `package.json`: Contains the dependencies. Uses standard `dev`, `build`, `start` scripts.
- `PENDING_TASKS.md` & `SUGGESTIONS_GEMINI.md`: Checklists for bugs, pending features, and UI/UX recommendations. Currently highlights needs like Supabase Auth, background processing (bypassing timeouts), and testing.

### `src/app` (Routing)
- `page.tsx` / `layout.tsx`: Landing page with top-level stats and entry points.
- `/import`: Flow for uploading CSV surveys and mapping columns.
- `/surveys`: Dashboard representing all active survey projects.
- `/units`: Management of `OrganizationUnit` entities (e.g., specific faculties or departments).
- `/analysis`: Core tool where AI loops through feedback. Processes raw responses, assigns taxonomy, and generates granular metrics.
- `/dashboard` & `/executive`: The visualization hubs. Shows heatmaps, radar charts, and stats.
- `/api`: Next.js Route Handlers. Segregated into `/api/ai` for Gemini interactions and `/api/executive` for aggregated UI datasets.

### `src/components`
- `ui/`: Standardized, reusable components (mostly from Shadcn/ui like Card, Button, Badge).
- `analytics/`: Contains the complex charting interfaces:
  - `PraisesRadar.tsx` & `IssuesRadar.tsx`: Radar charts displaying aggregated positive/negative sentiment categories.
  - `SentimentHeatmap.tsx`: A matrix showing unit vs. sentiment vs. category density.
  - `ExecutiveStats.tsx`: High-level aggregate metrics.
  - `HistoricalTrend.tsx`, `DependencyGraph.tsx`: Time-series and interconnected node visualizations.
- `analysis/`: Specialized UI for the AI processing pipelines.
- `layout/`: Top-level navigations, themes, error boundaries, ConfirmDialogs.

### `src/lib`
- `ai.ts`: The Gemini connector. Exports `callGemini(prompt, options)`. Crucial features: prompt injection sanitization, automatic JSON parsing logic, handling AI context size limits (`MAX_INPUT_LENGTH`).
- `supabase.ts`: Simple Supabase client wrapper.
- `validators.ts`: Zod schema definitions meant to ensure AI outputs strictly match the DB interfaces.
- `env.ts`: Runtime checks ensuring keys like `GEMINI_API_KEY` are present.

### `src/types` (`index.ts`)
The foundational data contracts that bond the DB, UI, and AI:
- `OrganizationUnit`: Represents a faculty or department.
- `Survey`: The overarching project wrapper.
- `RawFeedbackInput`: A single row of user feedback from a CSV.
- `FeedbackSegment`: The result of AI analysis. One raw input might map to multiple segments (e.g., one sentence is positive about "Facilities", another is negative about "Teaching"). This tracks `sentiment` ("Positive", "Negative", "Neutral").
- `Category` / `Subcategory`: Taxonomy applied to segments.
- `AnalysisResult` / `BatchResult`: Shapes expected from the Gemini API when processing data via `lib/ai.ts`.

## 3. Core Operational Flows

1. **Import Flow:** User hits `/import` -> Uploads CSV -> PapaParse transforms it -> User maps columns to `ColumnType` (SCORE, CATEGORY, TEXT) -> Saved to `raw_feedback_inputs`.
2. **Analysis Flow:** User enters `/analysis` -> Identifies unit -> Sends chunked `RawFeedbackInput` items to `/api/ai` -> Gemini breaks them into `FeedbackSegment`s with `Sentiment` -> Result is validated via Zod -> Saved to DB.
3. **Executive Flow:** User opens `/executive` -> UI requests aggregate views from `/api/executive` -> Complex SQL/Supabase aggregations group segments by unit and sentiment -> Plotted using `recharts` in `/analytics` components.

## 4. Key Considerations for AI Assistants
- **Timeouts:** Long-running requests in Next.js Serverless routes might time out when pinging Gemini. Keep loops small or adapt to background processing as noted in `PENDING_TASKS.md`.
- **Database Rules:** No RLS (Row Level Security) is currently established, but it is high on the priority list.
- **Styling:** Adhere strictly to Tailwind utility classes. Maintain the glassy/fluid aesthetic described in the layout variables.`
